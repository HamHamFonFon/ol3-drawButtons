ol.control.DrawButtons=function(e){var t=e||{};t.draw.Ending=!0,this.selectedLayers=t.selectedLayer;var o=this;void 0==t.style_buttons&&(t.style_buttons="default"),1==t.popup_form&&(this.popup=document.getElementById("popup")),this.typeSelect="Point",this.map=this.getMap(),this.flagDraw=new Boolean(!1),this.setFlagDraw(this.flagDraw),this.olClassName="ol-unselectable ol-control",this.drawContainer="toggle-control",this.drawClassName=this.olClassName+" "+this.drawContainer,this.olGroupClassName="ol-control-group";var n=new ol.Collection,l=new ol.Collection,a=function(e){e=e||window.event;for(var t=o.element.getElementsByClassName("div-controls")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0;for(var t=o.element.getElementsByClassName("div-draw")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0,"ending"==t.item(n).type_control&&(t.item(n).classList.remove("hidden"),t.item(n).disabled=!1);e.target.classList.toggle("enable"),e.target.disabled=!1,o.drawOnMap(e),e.preventDefault()},r=function(e){e=e||window.event;for(var t=o.element.getElementsByClassName("div-controls")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0,"ending"==t.item(n).type_control&&(t.item(n).classList.remove("hidden"),t.item(n).disabled=!1);for(var t=o.element.getElementsByClassName("div-draw")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0;switch(e.target.classList.toggle("enable"),e.target.disabled=!1,e.target.type_control){case"edit":o.controlEditOnMap(e);break;case"delete":o.controlDelOnMap(e)}e.preventDefault()},i=function(e){for(var t=o.element.querySelectorAll(".div-controls button, .div-draw button"),n=0;n<t.length;n++)t.item(n).disabled=!1,"ending"==t.item(n).type_control&&(t.item(n).classList.contains("hidden")||t.item(n).classList.toggle("hidden"));o.map.removeInteraction(o.drawInteraction),o.map.removeInteraction(o.editSelectInteraction),o.map.removeInteraction(o.modifyInteraction),o.map.removeInteraction(o.delInteraction),o.setFlagDraw(!1),e.preventDefault()},s=this.buttonPoint=document.createElement("button");s.setAttribute("title","Draw point"),s.id=s.draw="Point",s.type_control="draw",s.addEventListener("click",a,!1),n.push(s);var c=this.buttonLine=document.createElement("button");c.setAttribute("title","Draw line"),c.id=c.draw="LineString",c.type_control="draw",c.addEventListener("click",a,!1),n.push(c);var d=this.buttonCircle=document.createElement("button");d.setAttribute("title","Draw square"),d.id=d.draw="Square",d.type_control="draw",d.addEventListener("click",a,!1),n.push(d);var h=this.buttonCircle=document.createElement("button");h.setAttribute("title","Draw circle"),h.id=h.draw="Circle",h.type_control="draw",h.addEventListener("click",a,!1),n.push(h);var p=this.buttonPolygone=document.createElement("button");p.setAttribute("title","Draw polygone"),p.id=p.draw="Polygon",p.type_control="draw",p.addEventListener("click",a,!1),n.push(p);var u=this.buttonDrawEnd=document.createElement("button");u.setAttribute("title","Ending draw mode"),u.id=u.draw="Ending",u.type_control="ending",u.addEventListener("click",i,!1),n.push(u);var m=this.buttonEdit=document.createElement("button");m.setAttribute("title","Edit feature"),m.id="Edit",m.type_control="edit",m.addEventListener("click",r,!1),l.push(m);var g=this.buttonEdit=document.createElement("button");g.setAttribute("title","Delete feature"),g.id="Delete",g.type_control="delete",g.addEventListener("click",r,!1),l.push(g);var y=this.buttonControlEnd=document.createElement("button");y.setAttribute("title","Ending control mode"),y.id="Ending",y.type_control="ending",y.addEventListener("click",i,!1),l.push(y),"glyphicon"==t.style_buttons?(s.className="glyphicon glyphicon-map-marker",c.className="glyphicon glyphicon-vector-path-line",d.className="glyphicon glyphicon-vector-path-square",h.className="glyphicon glyphicon-vector-path-circle",p.className="glyphicon glyphicon-vector-path-polygon",u.className="glyphicon glyphicon-ok hidden",m.className="glyphicon glyphicon-pencil",g.className="glyphicon glyphicon-trash",y.className="glyphicon glyphicon-ok hidden"):(s.className="glyphicon-vector-path-point",c.className="glyphicon-vector-path-line",d.className="glyphicon-vector-path-square",h.className="glyphicon-vector-path-circle",p.className="glyphicon-vector-path-polygon",u.className="glyphicon-vector-path-ok hidden",m.className="glyphicon-vector-path-pencil",g.className="glyphicon-vector-path-trash",y.className="glyphicon-vector-path-ok hidden");var w=document.createElement("div");w.className="div-draw "+this.olGroupClassName,n.forEach(function(e){1==t.draw[e.draw]&&w.appendChild(e)});var v=document.createElement("div");v.className="div-controls "+this.olGroupClassName,l.forEach(function(e){v.appendChild(e)});var f=document.createElement("div");f.className=this.drawClassName,f.appendChild(w),f.appendChild(v),ol.control.Control.call(this,{element:f,target:t.target})},ol.inherits(ol.control.DrawButtons,ol.control.Control),ol.control.DrawButtons.prototype.drawOnMap=function(e){if(this.map=this.getMap(),this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){var t,o=e.target.draw;"Square"==o&&(o="Circle",t=ol.interaction.Draw.createRegularPolygon(4));var n=this.drawInteraction=new ol.interaction.Draw({source:this.getSelectedLayer().getSource(),features:new ol.Collection,type:o,geometryFunction:t,style:this.styleAdd()});n.on("drawend",this.drawEndFeature,this),this.map.addInteraction(n)}},ol.control.DrawButtons.prototype.controlEditOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=(this.getSelectedLayer(),this.editSelectInteraction=new ol.interaction.Select({condition:ol.events.condition.click}));this.map.addInteraction(t),t.getFeatures().addEventListener("add",function(e){var t=e.element;t.addEventListener("change",function(e){console.log(t.getGeometry())}),console.log(t.getGeometry())});var o=this.modifyInteraction=new ol.interaction.Modify({features:t.getFeatures(),style:this.styleEdit()});this.map.addInteraction(o)}},ol.control.DrawButtons.prototype.controlDelOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=this.delInteraction=new ol.interaction.Select({condition:ol.events.condition.click,source:function(e){return e==this.getSelectedLayer()?e:void 0}}),o=this;t.getFeatures().addEventListener("add",function(e){var n=e.element;confirm("Are you sure you want to delete this feature ?")?(o.getSelectedLayer().getSource().removeFeature(n),t.getFeatures().remove(n)):t.getFeatures().remove(n),e.preventDefault()}),this.map.addInteraction(t)}},ol.control.DrawButtons.prototype.styleAdd=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[69,175,157,.4]}),stroke:new ol.style.Stroke({color:[0,75,82,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[60,255,100,.4]}),stroke:new ol.style.Stroke({color:[255,255,255,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.styleEdit=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.drawEndFeature=function(e){var t=e.feature,o=new ol.format.GeoJSON;if("Circle"==t.type);else var n=o.writeFeatureObject(t);console.log(n)},ol.control.DrawButtons.prototype.setSelectedLayer=function(e){this.selectedLayers=e},ol.control.DrawButtons.prototype.getSelectedLayer=function(){return this.selectedLayers},ol.control.DrawButtons.prototype.setFlagDraw=function(e){this.flagDraw=e},ol.control.DrawButtons.prototype.getFlagDraw=function(){return this.flagDraw};