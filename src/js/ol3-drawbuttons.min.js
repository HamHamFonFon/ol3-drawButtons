ol.control.DrawButtons=function(e,t){var o=t||{};o.draw.Ending=!0,this.selectedLayers=e,this.typeSelect="Point",this.map=this.getMap(),this.flagDraw=new Boolean(!1),this.flagLocStor=new Boolean(!1),this.setFlagDraw(this.flagDraw),this.setFlagLocStor(this.flagLocStor);var n=this;if(this.setFlagLocStor(!1),1==o.local_storage&&(this.setFlagLocStor(!0),null!==localStorage.getItem("features"))){var r=(new ol.format.GeoJSON).readFeatures(JSON.parse(localStorage.getItem("features"))),l=new ol.source.Vector({features:r});this.selectedLayers.setSource(l)}this.setSelectedLayer(this.selectedLayers),void 0==o.style_buttons&&(o.style_buttons="default"),1==o.popup_form&&(this.popup=document.getElementById("popup")),this.olClassName="ol-unselectable ol-control",this.drawContainer="toggle-control",this.drawClassName=this.olClassName+" "+this.drawContainer,this.olGroupClassName="ol-control-group";var a=new ol.Collection,i=new ol.Collection,s=function(e){e=e||window.event;for(var t=n.element.getElementsByClassName("div-controls")[0].children,o=0;o<t.length;o++)t.item(o).classList.remove("enable"),t.item(o).classList.remove("progress"),t.item(o).disabled=!0;for(var t=n.element.getElementsByClassName("div-draw")[0].children,o=0;o<t.length;o++)t.item(o).classList.remove("enable"),t.item(o).classList.remove("progress"),t.item(o).disabled=!0,"ending"==t.item(o).type_control&&(t.item(o).classList.remove("hidden"),t.item(o).disabled=!1);e.target.classList.toggle("progress"),n.drawOnMap(e),e.preventDefault()},c=function(e){e=e||window.event;for(var t=n.element.getElementsByClassName("div-controls")[0].children,o=0;o<t.length;o++)t.item(o).classList.remove("enable"),t.item(o).classList.remove("progress"),t.item(o).disabled=!0,"ending"==t.item(o).type_control&&(t.item(o).classList.remove("hidden"),t.item(o).disabled=!1);for(var t=n.element.getElementsByClassName("div-draw")[0].children,o=0;o<t.length;o++)t.item(o).classList.remove("enable"),t.item(o).classList.remove("progress"),t.item(o).disabled=!0;switch(e.target.classList.toggle("progress"),e.target.type_control){case"edit":n.controlEditOnMap(e);break;case"delete":n.controlDelOnMap(e)}e.preventDefault()},d=function(e){for(var t=n.element.querySelectorAll(".div-controls button, .div-draw button"),o=0;o<t.length;o++)t.item(o).disabled=!1,"ending"==t.item(o).type_control&&(t.item(o).classList.contains("hidden")||t.item(o).classList.toggle("hidden"));void 0!=n.drawInteraction&&1==n.drawInteraction.getActive()&&(n.drawInteraction.setActive(!1),n.map.removeInteraction(n.drawInteraction)),void 0!=n.editSelectInteraction&&1==n.editSelectInteraction.getActive()&&(n.editSelectInteraction.setActive(!1),n.map.removeInteraction(n.editSelectInteraction)),void 0!=n.delInteraction&&n.delInteraction.getActive()&&(n.delInteraction.setActive(!1),n.map.removeInteraction(n.delInteraction)),void 0!=n.modifyInteraction&&1==n.modifyInteraction.getActive()&&(n.modifyInteraction.setActive(!1),n.map.removeInteraction(n.modifyInteraction)),void 0!=n.selectDelInteraction&&n.selectDelInteraction.getActive()&&(n.selectDelInteraction.setActive(!1),n.map.removeInteraction(n.selectDelInteraction)),void 0!=n.delInteraction&&n.delInteraction.getActive()&&(n.delInteraction.setActive(!1),n.map.removeInteraction(n.delInteraction)),1==n.getFlagLocStor()&&n.setFeaturesInLocalStorage(),n.setFlagDraw(!1),e.preventDefault()},g=this.buttonPoint=document.createElement("button");g.setAttribute("title","Draw point"),g.id=g.draw="Point",g.type_control="draw",g.addEventListener("click",s,!1),a.push(g);var h=this.buttonLine=document.createElement("button");h.setAttribute("title","Draw line"),h.id=h.draw="LineString",h.type_control="draw",h.addEventListener("click",s,!1),a.push(h);var u=this.buttonCircle=document.createElement("button");u.setAttribute("title","Draw square"),u.id=u.draw="Square",u.type_control="draw",u.addEventListener("click",s,!1),a.push(u);var m=this.buttonCircle=document.createElement("button");m.setAttribute("title","Draw circle"),m.id=m.draw="Circle",m.type_control="draw",m.addEventListener("click",s,!1),a.push(m);var p=this.buttonPolygone=document.createElement("button");p.setAttribute("title","Draw polygone"),p.id=p.draw="Polygon",p.type_control="draw",p.addEventListener("click",s,!1),a.push(p);var v=this.buttonDrawEnd=document.createElement("button");v.setAttribute("title","Ending draw mode"),v.id=v.draw="Ending",v.type_control="ending",v.addEventListener("click",d,!1),v.removeEventListener("dblclick",d),a.push(v);var y=this.buttonEdit=document.createElement("button");y.setAttribute("title","Edit feature"),y.id="Edit",y.type_control="edit",y.addEventListener("click",c,!1),i.push(y);var w=this.buttonEdit=document.createElement("button");w.setAttribute("title","Delete feature"),w.id="Delete",w.type_control="delete",w.addEventListener("click",c,!1),i.push(w);var f=this.buttonControlEnd=document.createElement("button");f.setAttribute("title","Ending control mode"),f.id="Ending",f.type_control="ending",f.addEventListener("click",d,!1),f.removeEventListener("dblclick",d),i.push(f),"glyphicon"==o.style_buttons?(g.className="glyphicon glyphicon-map-marker",h.className="glyphicon icon-large icon-vector-path-line",u.className="glyphicon icon-vector-path-square",m.className="glyphicon icon-vector-path-circle",p.className="glyphicon icon-vector-path-polygon",v.className="glyphicon glyphicon-ok hidden",y.className="glyphicon glyphicon-pencil",w.className="glyphicon glyphicon-trash",f.className="glyphicon glyphicon-ok hidden"):(g.className="glyphicon-vector-path-point",h.className="glyphicon-vector-path-line",u.className="glyphicon-vector-path-square",m.className="glyphicon-vector-path-circle",p.className="glyphicon-vector-path-polygon",v.className="glyphicon-vector-path-ok hidden",y.className="glyphicon-vector-path-pencil",w.className="glyphicon-vector-path-trash",f.className="glyphicon-vector-path-ok hidden");var L=document.createElement("div");L.className="div-draw "+this.olGroupClassName,a.forEach(function(e){e.removeEventListener("dblclick",s),1==o.draw[e.draw]&&L.appendChild(e)});var D=document.createElement("div");D.className="div-controls "+this.olGroupClassName,i.forEach(function(e){e.removeEventListener("dblclick",c),D.appendChild(e)});var S=document.createElement("div");S.className=this.drawClassName,S.appendChild(L),S.appendChild(D),ol.control.Control.call(this,{element:S,target:o.target})},ol.inherits(ol.control.DrawButtons,ol.control.Control),ol.control.DrawButtons.prototype.drawOnMap=function(e){if(this.map=this.getMap(),this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){var t,o=e.target.draw;"Square"==o&&(o="Circle",t=this.geometryFctDraw=ol.interaction.Draw.createRegularPolygon(4));var n=this.drawInteraction=new ol.interaction.Draw({source:this.getSelectedLayer().getSource(),features:new ol.Collection,type:o,geometryFunction:t,style:this.styleAdd()});n.on("drawend",this.drawEndFeature,this),this.map.addInteraction(n)}},ol.control.DrawButtons.prototype.drawEndFeature=function(e){var t=e.feature,o=new ol.format.GeoJSON;if(console.log("Add feature : "+t.getGeometry().getCoordinates()),"Circle"==t.type);else{o.writeFeatureObject(t)}},ol.control.DrawButtons.prototype.setFeaturesInLocalStorage=function(){var e=this.getSelectedLayer().getSource().getFeatures(),t=new ol.format.GeoJSON;if(e.length>0){var o=t.writeFeatures(e);localStorage.clear(),console.log("Number of feature : "+e.length),console.log(o),localStorage.setItem("features",JSON.stringify(o))}},ol.control.DrawButtons.prototype.controlEditOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=(this.getSelectedLayer(),this.editSelectInteraction=new ol.interaction.Select({condition:ol.events.condition.click}));this.map.addInteraction(t),t.getFeatures().addEventListener("add",function(e){var t=e.element;t.addEventListener("change",function(e){console.log(t.getGeometry())}),console.log(t.getGeometry())});var o=this.modifyInteraction=new ol.interaction.Modify({features:t.getFeatures(),style:this.styleEdit()});this.map.addInteraction(o)}},ol.control.DrawButtons.prototype.controlDelOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=this.selectDelInteraction=new ol.interaction.Select({condition:ol.events.condition.click,source:function(e){return e==this.getSelectedLayer()?e:void 0}});this.map.addInteraction(t);var o=this;t.getFeatures().addEventListener("add",function(e){var n=e.element;if(confirm("Are you sure you want to delete this feature ?"))try{t.getFeatures().remove(n),o.getSelectedLayer().getSource().removeFeature(n)}catch(e){console.log(e.message)}e.preventDefault()});var n=this.delInteraction=new ol.interaction.Modify({style:this.styleEdit(),features:t.getFeatures(),deleteCondition:function(e){return ol.events.condition.singleClick(e)}});this.map.addInteraction(n)}},ol.control.DrawButtons.prototype.styleAdd=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[69,175,157,.4]}),stroke:new ol.style.Stroke({color:[0,75,82,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[60,255,100,.4]}),stroke:new ol.style.Stroke({color:[255,255,255,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.styleEdit=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.setSelectedLayer=function(e){this.selectedLayers=e},ol.control.DrawButtons.prototype.getSelectedLayer=function(){return this.selectedLayers},ol.control.DrawButtons.prototype.setFlagDraw=function(e){this.flagDraw=e},ol.control.DrawButtons.prototype.getFlagDraw=function(){return this.flagDraw},ol.control.DrawButtons.prototype.setFlagLocStor=function(e){this.flagLocStor=e},ol.control.DrawButtons.prototype.getFlagLocStor=function(){return this.flagLocStor};