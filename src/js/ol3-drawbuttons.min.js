ol.control.DrawButtons=function(e,t){this.selectedLayers=e;var n=t||{};n.draw.Ending=!0;var o=this;void 0==n.style_buttons&&(n.style_buttons="default"),1==n.popup_form&&(this.popup=document.getElementById("popup")),this.typeSelect="Point",this.map=this.getMap(),this.flagDraw=new Boolean(!1),this.setFlagDraw(this.flagDraw),this.olClassName="ol-unselectable ol-control",this.drawContainer="toggle-control",this.drawClassName=this.olClassName+" "+this.drawContainer,this.olGroupClassName="ol-control-group";var i=new ol.Collection,l=new ol.Collection,a=function(e){e=e||window.event;for(var t=o.element.getElementsByClassName("div-controls")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0;for(var t=o.element.getElementsByClassName("div-draw")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0,"ending"==t.item(n).type_control&&(t.item(n).classList.remove("hidden"),t.item(n).disabled=!1);e.target.classList.toggle("enable"),e.target.disabled=!1,o.drawOnMap(e),e.preventDefault()},r=function(e){e=e||window.event;for(var t=o.element.getElementsByClassName("div-controls")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0,"ending"==t.item(n).type_control&&(t.item(n).classList.remove("hidden"),t.item(n).disabled=!1);for(var t=o.element.getElementsByClassName("div-draw")[0].children,n=0;n<t.length;n++)t.item(n).classList.remove("enable"),t.item(n).disabled=!0;switch(e.target.classList.toggle("enable"),e.target.disabled=!1,e.target.type_control){case"edit":o.controlEditOnMap(e);break;case"delete":o.controlDelOnMap(e)}e.preventDefault()},c=function(e){for(var t=o.element.querySelectorAll(".div-controls button, .div-draw button"),n=0;n<t.length;n++)t.item(n).disabled=!1,"ending"==t.item(n).type_control&&(t.item(n).classList.contains("hidden")||t.item(n).classList.toggle("hidden"));void 0!=o.drawInteraction&&1==o.drawInteraction.getActive()&&(o.drawInteraction.setActive(!1),o.map.removeInteraction(o.drawInteraction)),void 0!=o.editSelectInteraction&&1==o.editSelectInteraction.getActive()&&(o.editSelectInteraction.setActive(!1),o.map.removeInteraction(o.editSelectInteraction)),void 0!=o.delInteraction&&o.delInteraction.getActive()&&(o.delInteraction.setActive(!1),o.map.removeInteraction(o.delInteraction)),void 0!=o.modifyInteraction&&1==o.modifyInteraction.getActive()&&(o.modifyInteraction.setActive(!1),o.map.removeInteraction(o.modifyInteraction)),void 0!=o.selectDelInteraction&&o.selectDelInteraction.getActive()&&(o.selectDelInteraction.setActive(!1),o.map.removeInteraction(o.selectDelInteraction)),void 0!=o.delInteraction&&o.delInteraction.getActive()&&(o.delInteraction.setActive(!1),o.map.removeInteraction(o.delInteraction)),o.setFlagDraw(!1),e.preventDefault()},s=this.buttonPoint=document.createElement("button");s.setAttribute("title","Draw point"),s.id=s.draw="Point",s.type_control="draw",s.addEventListener("click",a,!1),i.push(s);var d=this.buttonLine=document.createElement("button");d.setAttribute("title","Draw line"),d.id=d.draw="LineString",d.type_control="draw",d.addEventListener("click",a,!1),i.push(d);var h=this.buttonCircle=document.createElement("button");h.setAttribute("title","Draw square"),h.id=h.draw="Square",h.type_control="draw",h.addEventListener("click",a,!1),i.push(h);var m=this.buttonCircle=document.createElement("button");m.setAttribute("title","Draw circle"),m.id=m.draw="Circle",m.type_control="draw",m.addEventListener("click",a,!1),i.push(m);var p=this.buttonPolygone=document.createElement("button");p.setAttribute("title","Draw polygone"),p.id=p.draw="Polygon",p.type_control="draw",p.addEventListener("click",a,!1),i.push(p);var u=this.buttonDrawEnd=document.createElement("button");u.setAttribute("title","Ending draw mode"),u.id=u.draw="Ending",u.type_control="ending",u.addEventListener("click",c,!1),u.removeEventListener("dblclick",c),i.push(u);var g=this.buttonEdit=document.createElement("button");g.setAttribute("title","Edit feature"),g.id="Edit",g.type_control="edit",g.addEventListener("click",r,!1),l.push(g);var v=this.buttonEdit=document.createElement("button");v.setAttribute("title","Delete feature"),v.id="Delete",v.type_control="delete",v.addEventListener("click",r,!1),l.push(v);var y=this.buttonControlEnd=document.createElement("button");y.setAttribute("title","Ending control mode"),y.id="Ending",y.type_control="ending",y.addEventListener("click",c,!1),y.removeEventListener("dblclick",c),l.push(y),"glyphicon"==n.style_buttons?(s.className="glyphicon glyphicon-map-marker",d.className="glyphicon icon-large icon-vector-path-line",h.className="glyphicon icon-vector-path-square",m.className="glyphicon icon-vector-path-circle",p.className="glyphicon icon-vector-path-polygon",u.className="glyphicon glyphicon-ok hidden",g.className="glyphicon glyphicon-pencil",v.className="glyphicon glyphicon-trash",y.className="glyphicon glyphicon-ok hidden"):(s.className="glyphicon-vector-path-point",d.className="glyphicon-vector-path-line",h.className="glyphicon-vector-path-square",m.className="glyphicon-vector-path-circle",p.className="glyphicon-vector-path-polygon",u.className="glyphicon-vector-path-ok hidden",g.className="glyphicon-vector-path-pencil",v.className="glyphicon-vector-path-trash",y.className="glyphicon-vector-path-ok hidden");var w=document.createElement("div");w.className="div-draw "+this.olGroupClassName,i.forEach(function(e){e.removeEventListener("dblclick",a),1==n.draw[e.draw]&&w.appendChild(e)});var f=document.createElement("div");f.className="div-controls "+this.olGroupClassName,l.forEach(function(e){e.removeEventListener("dblclick",r),f.appendChild(e)});var b=document.createElement("div");b.className=this.drawClassName,b.appendChild(w),b.appendChild(f),ol.control.Control.call(this,{element:b,target:n.target})},ol.inherits(ol.control.DrawButtons,ol.control.Control),ol.control.DrawButtons.prototype.drawOnMap=function(e){if(this.map=this.getMap(),this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){var t,n=e.target.draw;"Square"==n&&(n="Circle",t=this.geometryFctDraw=ol.interaction.Draw.createRegularPolygon(4));var o=this.drawInteraction=new ol.interaction.Draw({source:this.getSelectedLayer().getSource(),features:new ol.Collection,type:n,geometryFunction:t,style:this.styleAdd()});o.on("drawend",this.drawEndFeature,this),this.map.addInteraction(o)}},ol.control.DrawButtons.prototype.controlEditOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=(this.getSelectedLayer(),this.editSelectInteraction=new ol.interaction.Select({condition:ol.events.condition.click}));this.map.addInteraction(t),t.getFeatures().addEventListener("add",function(e){var t=e.element;t.addEventListener("change",function(e){console.log(t.getGeometry())}),console.log(t.getGeometry())});var n=this.modifyInteraction=new ol.interaction.Modify({features:t.getFeatures(),style:this.styleEdit()});this.map.addInteraction(n)}},ol.control.DrawButtons.prototype.controlDelOnMap=function(e){if(this.getSelectedLayer()?this.setFlagDraw(!0):this.setFlagDraw(!1),1==this.getFlagDraw()){this.map=this.getMap();var t=this.selectDelInteraction=new ol.interaction.Select({condition:ol.events.condition.click,source:function(e){return e==this.getSelectedLayer()?e:void 0}});this.map.addInteraction(t);var n=this;t.getFeatures().addEventListener("add",function(e){var o=e.element;if(confirm("Are you sure you want to delete this feature ?"))try{t.getFeatures().remove(o),n.getSelectedLayer().getSource().removeFeature(o)}catch(e){console.log(e.message)}e.preventDefault()});var o=this.delInteraction=new ol.interaction.Modify({style:this.styleEdit(),features:t.getFeatures(),deleteCondition:function(e){return ol.events.condition.singleClick(e)}});this.map.addInteraction(o)}},ol.control.DrawButtons.prototype.styleAdd=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[69,175,157,.4]}),stroke:new ol.style.Stroke({color:[0,75,82,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[60,255,100,.4]}),stroke:new ol.style.Stroke({color:[255,255,255,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.styleEdit=function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:[4,100,128,.4]}),stroke:new ol.style.Stroke({color:[0,64,28,.75],width:1.5})}),zIndex:1e5});return e},ol.control.DrawButtons.prototype.drawEndFeature=function(e){var t=e.feature,n=new ol.format.GeoJSON;if("Circle"==t.type);else var o=n.writeFeatureObject(t);console.log(o)},ol.control.DrawButtons.prototype.setSelectedLayer=function(e){this.selectedLayers=e},ol.control.DrawButtons.prototype.getSelectedLayer=function(){return this.selectedLayers},ol.control.DrawButtons.prototype.setFlagDraw=function(e){this.flagDraw=e},ol.control.DrawButtons.prototype.getFlagDraw=function(){return this.flagDraw};